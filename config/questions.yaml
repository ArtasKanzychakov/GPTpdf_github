#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞
"""

import os
import json
from dataclasses import dataclass, field
from pathlib import Path
from typing import Dict, Any, List, Optional, Union

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏–∑ enums
from models.enums import NicheCategory, NicheDetails, QuestionType

@dataclass
class BotConfig:
    """–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞"""

    # –¢–æ–∫–µ–Ω—ã –∏ –∫–ª—é—á–∏
    telegram_token: str = field(default_factory=lambda: os.getenv('TELEGRAM_BOT_TOKEN', ''))
    openai_api_key: str = field(default_factory=lambda: os.getenv('OPENAI_API_KEY', ''))

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞
    host: str = field(default_factory=lambda: os.getenv('HOST', '0.0.0.0'))
    port: int = field(default_factory=lambda: int(os.getenv('PORT', '10000')))

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ OpenAI
    openai_model: str = field(default_factory=lambda: os.getenv('OPENAI_MODEL', 'gpt-4-turbo-preview'))
    openai_temperature: float = field(default_factory=lambda: float(os.getenv('OPENAI_TEMPERATURE', '0.7')))
    openai_max_tokens: int = field(default_factory=lambda: int(os.getenv('OPENAI_MAX_TOKENS', '2000')))

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞
    bot_language: str = field(default_factory=lambda: os.getenv('BOT_LANGUAGE', 'ru'))
    cleanup_hours: int = field(default_factory=lambda: int(os.getenv('CLEANUP_HOURS', '24')))
    max_questions: int = field(default_factory=lambda: int(os.getenv('MAX_QUESTIONS', '35')))  # –£–≤–µ–ª–∏—á–∏–ª –¥–æ 35 –¥–ª—è YAML

    # –î–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å–æ–≤
    questions: List[Dict[str, Any]] = field(default_factory=list)
    question_categories: Dict[str, str] = field(default_factory=dict)
    niche_categories: List[NicheDetails] = field(default_factory=list)

    def __post_init__(self):
        """–ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏"""
        config_dir = Path(__file__).parent
        
        print("üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...")
        print(f"üìÅ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: {config_dir}")

        # –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å YAML (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç), –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è - JSON
        yaml_path = config_dir / 'questions.yaml'
        json_path = config_dir / 'questions.json'
        
        loaded_data = None
        file_format = ""
        
        # –ü—Ä–æ–±—É–µ–º YAML
        if yaml_path.exists():
            try:
                import yaml
                with open(yaml_path, 'r', encoding='utf-8') as f:
                    loaded_data = yaml.safe_load(f)
                file_format = "YAML"
                print("‚úÖ –§–∞–π–ª questions.yaml –Ω–∞–π–¥–µ–Ω –∏ –∑–∞–≥—Ä—É–∂–µ–Ω")
            except ImportError:
                print("‚ùå PyYAML –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. pip install pyyaml")
            except Exception as e:
                print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ YAML: {e}")
        
        # –ï—Å–ª–∏ YAML –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è, –ø—Ä–æ–±—É–µ–º JSON
        if not loaded_data and json_path.exists():
            try:
                with open(json_path, 'r', encoding='utf-8') as f:
                    loaded_data = json.load(f)
                file_format = "JSON"
                print("‚úÖ –§–∞–π–ª questions.json –Ω–∞–π–¥–µ–Ω –∏ –∑–∞–≥—Ä—É–∂–µ–Ω")
            except Exception as e:
                print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ JSON: {e}")
        
        if not loaded_data:
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∏ –æ–¥–∏–Ω —Ñ–∞–π–ª —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏")
            print(f"   –û–∂–∏–¥–∞–ª—Å—è –æ–¥–∏–Ω –∏–∑: {yaml_path} –∏–ª–∏ {json_path}")
            # –°–æ–∑–¥–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∞
            self._create_minimal_questions()
            self._create_default_niches()
            return

        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        try:
            if file_format == "YAML":
                # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ YAML —Ñ–∞–π–ª–∞
                self.questions = loaded_data.get('questions', [])
                self.question_categories = {}  # –í YAML –Ω–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                
                print(f"üìù –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(self.questions)} –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ YAML")
                
                # –í–∞–ª–∏–¥–∞—Ü–∏—è YAML –≤–æ–ø—Ä–æ—Å–æ–≤
                for i, q in enumerate(self.questions):
                    if 'id' not in q:
                        q['id'] = f"q{i+1}"
                    if 'type' not in q:
                        q['type'] = 'text'
                    if 'category' not in q:
                        q['category'] = 'general'
                        
            else:  # JSON
                self.questions = loaded_data.get('questions', [])
                self.question_categories = loaded_data.get('categories', {})
                
                print(f"üìù –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(self.questions)} –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ JSON")

            # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∏—à
            if file_format == "JSON":
                niche_categories_data = loaded_data.get('niche_categories', [])
                self._load_niche_categories(niche_categories_data)
            else:
                # –î–ª—è YAML —Å–æ–∑–¥–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∏—à–∏
                self._create_default_niches()

            print(f"‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ {file_format}")
            print(f"   üìä –í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤: {len(self.questions)}")
            print(f"   üè¢ –ö–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∏—à: {len(self.niche_categories)}")
            
            # –î–ï–ë–ê–ì: –ø–µ—Ä–≤—ã–µ 3 –≤–æ–ø—Ä–æ—Å–∞
            if len(self.questions) > 0:
                print("\nüîç –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:")
                for i, q in enumerate(self.questions[:3]):
                    q_id = q.get('id', '–Ω–µ—Ç id')
                    q_text = q.get('text', '–Ω–µ—Ç —Ç–µ–∫—Å—Ç–∞')[:60]
                    q_type = q.get('type', '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')
                    print(f"   {i+1}. [{q_id}] {q_text}... (—Ç–∏–ø: {q_type})")

        except Exception as e:
            print(f"‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: {e}")
            import traceback
            traceback.print_exc()
            self._create_minimal_questions()
            self._create_default_niches()

    def _create_minimal_questions(self):
        """–°–æ–∑–¥–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
        print("‚ö†Ô∏è –°–æ–∑–¥–∞—é –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∞")
        self.questions = [
            {
                "id": "test_1",
                "text": "–¢–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å: –ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?",
                "type": "text",
                "category": "test"
            },
            {
                "id": "test_2", 
                "text": "–¢–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å 2: –ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?",
                "type": "text",
                "category": "test"
            }
        ]
        self.question_categories = {"test": "–¢–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è"}

    def _create_default_niches(self):
        """–°–æ–∑–¥–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∏—à"""
        print("üì¶ –°–æ–∑–¥–∞—é —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∏—à...")
        
        # –ú–∞–ø–ø–∏–Ω–≥ id –∏–∑ —Ñ–∞–π–ª–∞ –Ω–∞ enum –∑–Ω–∞—á–µ–Ω–∏—è
        category_map = {
            "QUICK_START": NicheCategory.QUICK_START,
            "BALANCED": NicheCategory.BALANCED,
            "LONG_TERM": NicheCategory.LONG_TERM,
            "RISKY": NicheCategory.RISKY,
            "HIDDEN": NicheCategory.HIDDEN
        }
        
        # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∏—à–∏
        default_niches_data = [
            {
                "id": "QUICK_START",
                "name": "–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç",
                "category": "QUICK_START",
                "description": "–ü—Ä–æ–µ–∫—Ç—ã —Å –±—ã—Å—Ç—Ä–æ–π –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å—é, –Ω–∏–∑–∫–∏–º –ø–æ—Ä–æ–≥–æ–º –≤—Ö–æ–¥–∞",
                "emoji": "üî•",
                "risk_level": 4,
                "time_to_profit": "1-3 –º–µ—Å—è—Ü–∞",
                "required_skills": ["–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥", "–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è", "–ë—ã—Å—Ç—Ä–æ–µ –æ–±—É—á–µ–Ω–∏–µ"],
                "min_budget": 50000,
                "success_rate": 0.6,
                "examples": ["–î—Ä–æ–ø—à–∏–ø–ø–∏–Ω–≥", "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏", "–§—Ä–∏–ª–∞–Ω—Å"]
            },
            {
                "id": "BALANCED",
                "name": "–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π",
                "category": "BALANCED",
                "description": "–û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ä–∏—Å–∫–∞ –∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏",
                "emoji": "üöÄ",
                "risk_level": 3,
                "time_to_profit": "3-6 –º–µ—Å—è—Ü–µ–≤",
                "required_skills": ["–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ", "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏"],
                "min_budget": 150000,
                "success_rate": 0.7,
                "examples": ["–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω", "SMM-–∞–≥–µ–Ω—Ç—Å—Ç–≤–æ", "–ö—É—Ä—Å—ã"]
            },
            {
                "id": "LONG_TERM",
                "name": "–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π",
                "category": "LONG_TERM",
                "description": "–°—Ç–∞–±–∏–ª—å–Ω—ã–π –±–∏–∑–Ω–µ—Å —Å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–º —Ä–æ—Å—Ç–æ–º",
                "emoji": "üå±",
                "risk_level": 2,
                "time_to_profit": "6-12 –º–µ—Å—è—Ü–µ–≤",
                "required_skills": ["–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ", "–¢–µ—Ä–ø–µ–Ω–∏–µ"],
                "min_budget": 300000,
                "success_rate": 0.8,
                "examples": ["–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç", "–§—Ä–∞–Ω—à–∏–∑–∞", "–ö–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥"]
            },
            {
                "id": "RISKY",
                "name": "–†–∏—Å–∫–æ–≤–∞–Ω–Ω—ã–π",
                "category": "RISKY",
                "description": "–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫, –Ω–æ –∏ –≤—ã—Å–æ–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥",
                "emoji": "üíé",
                "risk_level": 5,
                "time_to_profit": "1-3 –º–µ—Å—è—Ü–∞ (–∏–ª–∏ –ø—Ä–æ–≤–∞–ª)",
                "required_skills": ["–ê–Ω–∞–ª–∏–∑ —Ä–∏—Å–∫–æ–≤", "–ë—ã—Å—Ç—Ä–æ–µ –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π"],
                "min_budget": 500000,
                "success_rate": 0.4,
                "examples": ["–°—Ç–∞—Ä—Ç–∞–ø—ã", "–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã", "–í–µ–Ω—á—É—Ä–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã"]
            },
            {
                "id": "HIDDEN",
                "name": "–°–∫—Ä—ã—Ç–∞—è –Ω–∏—à–∞",
                "category": "HIDDEN",
                "description": "–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –Ω–∏—à–∏ —Å –Ω–∏–∑–∫–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–µ–π",
                "emoji": "üéØ",
                "risk_level": 3,
                "time_to_profit": "2-4 –º–µ—Å—è—Ü–∞",
                "required_skills": ["–ö—Ä–µ–∞—Ç–∏–≤–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ", "–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ä—ã–Ω–∫–∞"],
                "min_budget": 100000,
                "success_rate": 0.65,
                "examples": ["–ù–∏—à–µ–≤—ã–µ –∫—É—Ä—Å—ã", "–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ SaaS", "–£—Å–ª—É–≥–∏ –¥–ª—è —É–∑–∫–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏"]
            }
        ]
        
        self.niche_categories = []
        for niche_data in default_niches_data:
            try:
                niche_enum = category_map.get(niche_data['category'])
                if not niche_enum:
                    continue
                    
                niche_details = NicheDetails(
                    id=niche_data['id'],
                    name=niche_data['name'],
                    category=niche_enum,
                    description=niche_data['description'],
                    emoji=niche_data['emoji'],
                    risk_level=niche_data['risk_level'],
                    time_to_profit=niche_data['time_to_profit'],
                    required_skills=niche_data['required_skills'],
                    min_budget=niche_data['min_budget'],
                    success_rate=niche_data['success_rate'],
                    examples=niche_data['examples']
                )
                self.niche_categories.append(niche_details)
                
            except Exception as e:
                print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∏—à–∏ {niche_data.get('id')}: {e}")
        
        print(f"‚úÖ –°–æ–∑–¥–∞–Ω–æ {len(self.niche_categories)} —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –Ω–∏—à")

    def _load_niche_categories(self, niche_categories_data):
        """–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∏—à –∏–∑ –¥–∞–Ω–Ω—ã—Ö"""
        self.niche_categories = []
        
        if not niche_categories_data:
            self._create_default_niches()
            return
            
        for category_data in niche_categories_data:
            try:
                category_id = category_data.get('category')
                if not category_id:
                    continue
                    
                # –ò—â–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π Enum
                niche_enum = None
                for enum_item in NicheCategory:
                    if enum_item.name == category_id:
                        niche_enum = enum_item
                        break
                
                if not niche_enum:
                    print(f"‚ö†Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è '{category_id}' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ NicheCategory Enum")
                    continue

                # –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç NicheDetails
                niche_details = NicheDetails(
                    id=category_data.get('id', category_id),
                    name=category_data.get('name', category_id),
                    category=niche_enum,
                    description=category_data.get('description', ''),
                    emoji=category_data.get('emoji', 'üìä'),
                    risk_level=category_data.get('risk_level', 3),
                    time_to_profit=category_data.get('time_to_profit', ''),
                    required_skills=category_data.get('required_skills', []),
                    min_budget=category_data.get('min_budget', 0),
                    success_rate=category_data.get('success_rate', 0.5),
                    examples=category_data.get('examples', [])
                )

                self.niche_categories.append(niche_details)

            except Exception as e:
                print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {e}")

    def validate(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"""
        errors = []

        if not self.telegram_token:
            errors.append("TELEGRAM_BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")

        if len(self.questions) == 0:
            errors.append("–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤–æ–ø—Ä–æ—Å—ã –∞–Ω–∫–µ—Ç—ã")
        elif len(self.questions) < 3:
            errors.append(f"–°–ª–∏—à–∫–æ–º –º–∞–ª–æ –≤–æ–ø—Ä–æ—Å–æ–≤: {len(self.questions)}")

        if errors:
            print("‚ùå –û—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:")
            for error in errors:
                print(f"   - {error}")
            return False

        print("‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫—É")
        return True

    def get_question_by_id(self, question_id: str) -> Optional[Dict[str, Any]]:
        """–ü–æ–ª—É—á–∏—Ç—å –≤–æ–ø—Ä–æ—Å –ø–æ ID"""
        for question in self.questions:
            if question.get('id') == question_id:
                return question
        return None

    def get_question_by_index(self, index: int) -> Optional[Dict[str, Any]]:
        """–ü–æ–ª—É—á–∏—Ç—å –≤–æ–ø—Ä–æ—Å –ø–æ –∏–Ω–¥–µ–∫—Å—É"""
        if 0 <= index < len(self.questions):
            return self.questions[index]
        return None

    def get_total_questions(self) -> int:
        """–ü–æ–ª—É—á–∏—Ç—å –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤"""
        return len(self.questions)

    def get_niche_by_id(self, niche_id: str) -> Optional[NicheDetails]:
        """–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –Ω–∏—à–∏ –ø–æ ID"""
        for niche in self.niche_categories:
            if niche.id == niche_id:
                return niche
        return None

    def get_niche_by_enum(self, niche_enum: NicheCategory) -> Optional[NicheDetails]:
        """–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –Ω–∏—à–∏ –ø–æ Enum –∑–Ω–∞—á–µ–Ω–∏—é"""
        for niche in self.niche_categories:
            if niche.category == niche_enum:
                return niche
        return None

# –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
print("üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–æ—Ç–∞...")
try:
    config = BotConfig()
    if config.validate():
        print("‚ú® –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!")
    else:
        print("‚ö†Ô∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–º–µ–µ—Ç –æ—à–∏–±–∫–∏, –Ω–æ –±–æ—Ç –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è")
except Exception as e:
    print(f"üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: {e}")
    import traceback
    traceback.print_exc()
    # –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–ø—É—Å–∫–∞
    config = BotConfig()
    config.questions = []
    config.niche_categories = []